{
  "title": "KAPy calibration configuration",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Calibration is the process by which the outputs of a climate model are post-processed so that they match specific characteristics of the observed climate during a common period of time. In KAPy we wrap methods in two existing packages to enable model calibration - `python-cmethods` and `xclim`. The method employed is chosen via the `method` field, with the following valid options: \n* `cmethods-linear` - [Linear Scaling](https://python-cmethods.readthedocs.io/en/latest/methods.html#linear-scaling). \n * `cmethods-variance` - [Variance scaling](https://python-cmethods.readthedocs.io/en/latest/methods.html#variance-scaling) \n *  `cmethods-delta`- [Delta method](https://python-cmethods.readthedocs.io/en/latest/methods.html#variance-scaling) \n * `cmethods-quantile` - [Quantile Mapping](https://python-cmethods.readthedocs.io/en/latest/methods.html#quantile-mapping) \n * `cmethods-detrended` - [Detrended Quantile Mapping](https://python-cmethods.readthedocs.io/en/latest/methods.html#detrended-quantile-mapping) \n * `cmethods-quantile-delta` - [Quantile Delta Mapping](https://python-cmethods.readthedocs.io/en/latest/methods.html#quantile-delta-mapping) \n * `xclim-eqm` - [Empirical Quantile Mapping](https://xclim.readthedocs.io/en/stable/api.html#adjustment-methods) from the `xclim`package. \n * `xclim-scaling` - [Scaling bias-adjustment](https://xclim.readthedocs.io/en/stable/api.html#adjustment-methods) from the `xclim`package.\n * `custom` - Use a custom script, as specified in the `customScriptPath` and `customScriptFunction` arguments. \n \n For more information, see the documentation on the relevant packages: \n * `python-cmethods` - https://python-cmethods.readthedocs.io/en/latest/index.html \n * `xclim` https://xclim.readthedocs.io/en/stable/sdba.html",
  "type": "object",
  "required": [
    "id",
    "outVariable",
    "calibrationVariable",
    "calibSource",
    "refSource",
    "calPeriodStart",
    "calPeriodEnd",
    "method",
    "additionalArgs"
  ],
  "properties": {
    "id": {
      "type": "string",
      "uniqueItems": true,
      "pattern": "^[^ ]+$",
      "description": "Unique identifier for the calibration procedure."
    },
    "outVariable": {
      "type": "string",
      "description": "Variable name that will be associated with calibrated output. Note that this must not be a duplicate of other variable names found in the configuration of KAPy. A few suggested practices for referring to the raw and calibrated variables could be e.g. 1. `tas-RAW` and `tas` 2. `tas` and `tas-CAL` or 3. `tas` and `TAS`. The exact choice is not important, but it is recommended to adopt a consistent approach throughout the project."
    },
    "calibrationVariable": {
      "type": "string",
      "description": "The name of the variable to calibrate, drawn from the list of primary and secondary variables. If the variable cannot be found, an error will be raised. KAPy assumes that the same variable name is used for both the model and observational data sources."
    },
    "calibSource": {
      "type": "string",
      "description": "The ID of the data source that will be calibrated e.g.  'CORDEX'. This is most commonly the output of a climate model, but need not be. Multiple files within the same climate variable and data source are allowed. "
    },
    "refSource": {
      "type": "string",
      "description": "The ID of the data source that will be used as the reference  data source to calibrate against, such as `ERA5`. Most commonly this will be an observational data set, a reanalysis or similar but it need not be. However, the combination of climate variable and data source ID should uniquely identify a single file within the variable palette of KAPy - if not, an error will be raised."
    },
    "calPeriodStart": {
      "type": "string",
      "pattern": "^\\d{4}$",
      "description": "Start year of the calibration period. Data after and including 1 Jan of this year will be used for calibration."
    },
    "calPeriodEnd": {
      "type": "string",
      "pattern": "^\\d{4}$",
      "description": "End year of the calibration period. Data before and including 31 Dec of this year will be used for calibration."
    },
    "method": {
      "type": "string",
      "description": "Calibration method to be used. See above for a clarification of options.",
      "enum": [
        "cmethods-linear",
        "cmethods-variance",
        "cmethods-delta",
        "cmethods-quantile",
        "cmethods-detrended",
        "cmethods-quantile-delta",
        "xclim-eqm",
        "xclim-scaling",
        "custom"
    ]
    },
    "grouping": {
      "type": "string",
      "description": "Apply calibration independently of each time grouping selected here.",
      "enum": [
        "month",
        "season",
        "none"]
    },
    "additionalArgs": {
      "type": "string",
      "nullable": true,
      "description": "Additional arbitrary arguments specified as a dict to be passed to the function via keyword arguments. e.g. `{'kind'='+', group='time.month'}`. Can be an empty dict or empty string if no there are no additional parameters. e.g. `{}` "
    },
    "customScriptPath": {
      "type": "string",
      "nullable": true,
      "description": "If `method` is set to `custom`, this field is used to identify the path to a custom script, if applicable."
    },
    "customScriptFunction": {
      "type": "string",
      "nullable": true,
      "description": "Name of the function in `customScriptPath` to be used for bias correction,  if applicable."
    }
  },
  "additionalProperties": false
}

