{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "KAPy input configuration",
  "description": "The configuration of inputs in KAPy is set through a tab-separated table, with one row per input variable. The available configuration options are described here. All options are required",
  "type": "object",
  "required": [
    "id",
    "varID", 
    "srcID", 
    "path", 
    "internalVarName", 
    "gridField", 
    "experimentField", 
    "commonExperimentID", 
    "importScriptPath",
    "importScriptFunction"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "description": "A unique id for this dataset.",
      "uniqueItems": true
    },
    "varID": {
      "type": "string",
      "description": "The ID of the variable contained in this dataset. While there is no enforcement of naming conventions in KAPy, the variable names should anyway be standardised across the entire configuration and across input datasets. For example, both ERA5 and CORDEX provide surface temperature, but with different internal variable names in the input files - to ensure that they can be matched together, they should both be assigned the varName `tas`."
    },
    "srcID": {
      "type": "string",
      "description": "The ID of the data source e.g CORDEX, ERA5. Need not be unique. Is used to group related variables from the same datasource together further in the analysis (e.g. tas and pr from ERA5). "
    },
    "path": {
      "type": "string",
      "description": "Path to input files, relative to the working directory. Glob-matching (e.g. `./resources/CORDEX/tas_*`) can be used when the input covers multiple files and/or there are multiple variable types in the same directory."
    },
    "internalVarName": {
      "type": "string",
      "description": "The internal variable name used within the input file for the variable of interest. For example, in ERA5 files the internal variable name for surface temperature is `t2m` whereas in CORDEX is is `tas`."
    },
    "fieldSeparator": {
      "type": "string",
      "minLength": 0,
      "maxLength": 1,
      "description": "Character separating fields in the input file names. Most often an underscore character '_'. Currently limited to a single character."
    },
    "gridField": {
      "type": "string",
      "pattern": "^\\d*$",
      "description": "Number of the field in the filename representing grid information e.g. for the file `tas_AFR-22_NCC-NorESM1-M_rcp85_r1i1p1_CLMcom-KIT-CCLM5-0-15_v1_day_20360101-20401231.nc`, the second field (`AFR-22`) is the grid description and this parameter would therefore be set to 2. If not specified, the grid field will be given the code `native-grid`. It can be a good idea to also include the grid code in the ensember member codes, when the same model can be run with multiple grids. 1-based indexing is assumed.",
      "default": null
    },
    "experimentField": {
      "type": "string",
      "pattern": "^\\d*$",
      "description": "Number of the field in the filename to be used for forming dataseries based on scenarios e.g. for the file `tas_AFR-22_NCC-NorESM1-M_rcp85_r1i1p1_CLMcom-KIT-CCLM5-0-15_v1_day_20360101-20401231.nc`, the fourth field (`rcp85`) contains the emissions scenario code, and this parameter would then be set to 4. 1-based indexing is assumed.",
      "default": null
    },
    "commonExperimentID": {
      "type": ["string","null"],
      "description": "Many climate experiments, such as CMIP, involve splitting time into separate experiments e.g. a `historical` experiment that runs to 2005 and then the `rcp26` and `rcp85` scenario experiments that start from 2006. This field provides the name for the experiment that is common to all others (in this case `historical`) All (other) values of the `experimentField` will be concatenated with this experiment to produce one contiguous *dataseries*. Omission of this parameter will disable this feature, and all experiments will be processed individually.",
      "default": null
    },
    "ensMemberFields": {
      "type": ["string","null"],
      "description": "Comma-separated list of integers representing the fields to join together to make the *ensemble member identifier*. Including the grid descriptor in this configuration is often a good idea, when the same model can be run on two different grids. 1-based indexing is assumed.",
      "default": null
    },
    "importScriptPath": {
      "type": ["string", "null"],
      "description": "Path to the custom import script. Use this option to enable useage of a custom script to import data before being written to disk as primVars. If empty, then the default import system in KAPy will be used.",
      "default": null
    },
    "importScriptFunction": {
      "type": ["string", "null"],
      "description": "Function in the custom import script to be used. Must be supplied if `importScriptPath` is present.",
      "default": null
    }
  }
}
